<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8"> 
  <script src="arrayHelpers.js"></script>
  <script src="raphael.js"></script>
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script>
    var rootNode = null;
    
    function Point(x, y) {
      this.x = x;
      this.y = y;
    }
    
    function Canvas(left, top, width, height) {
      this.rows = [];
      this.left = left;
      this.top = top;
      this.width = width;
    }
    
    Canvas.prototype.addRow = function(node) {
      this.rows.push(new Row(node));
    }
    
    Canvas.prototype.bottom = function() {
      var b = 0;
      for(var i=0; i<this.rows.length; i++){
        var r = this.rows[i];
        b += r.height();
      }
    }
    
    function Row(top, node) {
      this.top = top;
      this.nodes = [];
      this.addNode(node);
    }
    
    Row.prototype.addNode = function(node) {
      this.nodes.push(node);
    }
    
    Row.prototype.height = function() {
      var h = this.rects[0].height;
      for(var i=0; i<this.rects.length; i++) {
        var r = this.rects[i];
        h = Math.max(h, r.height);
      }
      return h;
    }
    
    Row.prototype.bottom = function() {
      return this.top + this.height();
    }

    function Node(el, parent, root) {
      if(root) rootNode = this;
      this.el = el;
      this.width = el.width();
      this.height = el.height();
      if(parent){
        this.parent = parent;
      }
    }
    
    Node.prototype.setPosition = function(left, top) {
      this.el.css({
        top: top + 'px',
        left: left + 'px'
      });
    }
    
    Node.prototype.getCenter = function() {
      return new Point(this.el.position().left + this.width/2, this.el.position().top + this.height/2);
    }
    
    Node.prototype.remove = function() {
      if(this.parent) {
        this.parent.children.removeByValue(this);
      }
      this.el.remove();
    }
    
    var r = [];
    const WIDTH = 800;

    function makeDiv() {
      for (var i = 0; i < 20; i++) {
        var divwidth = ((Math.random() * 200) + 50).toFixed();
        var divheight = ((Math.random() * 200) + 50).toFixed();
        var color = '#' + Math.round(0xffffff * Math.random()).toString(16);
        $newdiv = $('<div><b>' + i + '</b></div>');

        var posx = Math.random() * 200;
        var posy = Math.random() * 200;

        $newdiv.css({
          'width': divwidth + 'px',
          'height': divheight + 'px',
          'background-color': color,
          'position': 'absolute',
          'left': posx + 'px',
          'top': posy + 'px',
          'border': '1px solid black'
        }).appendTo('body');
        
        if(i == 0) r.push(new Node($newdiv, null, true));
        else r.push(new Node($newdiv, r[0]));
      }

      oneColumn(r);
      //twoColumns(r);

      drawLines();

      //for(var i=0;i<r.length;i++){for(var j=0;j<r.length;j++){if(i!=j)console.log(i+" "+j+" :"+getOverlap(r[i],r[j]));}}
    }
    
    function drawLines() {
      var paper = Raphael("canvas", WIDTH, 800);
      for(var i = 0; i < r.length; i++) {
        var n = r[i];
        if(n.parent) {
          var xStart = n.getCenter().x, yStart = n.getCenter().y, xEnd = n.parent.getCenter().x, yEnd =n.parent.getCenter().y;
          var c = paper.path("M" + xStart + " " + yStart + " L" + xEnd + " " + yEnd);
        }
      }
    }

     //  Two Columns Heuristic

    function twoColumns(r) {
      var topLeft = 0,
        topRight = 0;
      var len = r.length;
      for (var i = 0; i < len; i++) {
        var re = r[i];
        if (re.width > WIDTH / 2) {
          console.log("width is " + re.width + ", setting to top");
          var xOff = Math.random() * (WIDTH - re.width);
          re.setPosition(xOff, topLeft);
          topLeft = topRight = topRight + re.height();
          console.log("top is now " + topRight);
        }
      }

      r.sort(function (a, b) {
        return b.height - a.height;
      })

      for (var i = 0; i < r.length; i++) {
        var re = r[i];
        if (re.width <= WIDTH / 2) {
          var xOff = Math.random() * (WIDTH / 2 - re.width);
          if (topLeft <= topRight) {
            re.setPosition(xOff, topLeft);
            topLeft += re.height;
          } else {
            re.setPosition(WIDTH / 2 + xOff, topRight);
            topRight += re.height;
          }
        }
      }

      var bottom = Math.max(topLeft, topRight);
      console.log(bottom);
    }

     //  One Column Heuristic

    function oneColumn(r) {
      var top = 0;
      var len = r.length;
      for (var i = 0; i < len; i++) {
        var re = r[i];
        if (re.width > WIDTH / 2) {
          console.log("width is " + re.width + ", setting to top");
          var xOff = Math.random() * (WIDTH - re.width);
          re.setPosition(xOff, top);
          top += re.height;
          console.log("top is now " + top);
        }
      }

      r.sort(function (a, b) {
        return b.height - a.height;
      })
      var left = WIDTH;
      var bottom = top;
      for (var i = 0; i < r.length; i++) {
        var re = r[i];
        if (re.width <= WIDTH / 2) {
          if (re.width <= left) { //fits in this row
            if (left == WIDTH) bottom = top + re.height; //this is the first here, set top
            re.setPosition(WIDTH - left, top);
            left -= re.width;
          } else {
            left = WIDTH;
            top = bottom;
            re.setPosition(WIDTH - left, top);
            bottom = top + re.height;
            left -= re.width;
          }
        }
      }
      console.log(bottom);
    }

     // recursive division???

  </script>
  <style>
    #wrapper {
        position: relative;
        width: 800px;
        height: 800px;
        top: 0;
        left: 0;
        padding: 0;
        margin: 0;
        border: 1px solid black;
    }
    #container {
        position: absolute;
        top: 0;
        left: 0;
        background-color: #CCC;
    }
    #canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
    }
    </style>
</head>
<body onload="makeDiv();">
  <div id="wrapper">
    <div id="container">
    <div id="canvas">
    </div>
  </div>
</body>
</html>
